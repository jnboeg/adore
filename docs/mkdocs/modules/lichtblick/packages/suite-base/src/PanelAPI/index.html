
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../../../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.47">
    
    
      
        <title>PanelAPI - ADORe Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#panelapi" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../.." title="ADORe Documentation" class="md-header__button md-logo" aria-label="ADORe Documentation" data-md-component="logo">
      
  <img src="../../../../../../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ADORe Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PanelAPI
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="ADORe Documentation" class="md-nav__button md-logo" aria-label="ADORe Documentation" data-md-component="logo">
      
  <img src="../../../../../../../img/logo.png" alt="logo">

    </a>
    ADORe Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About ADORe
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../quick_start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../getting_started/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../getting_started/system_requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Requirements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../getting_started/prerequisites/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prerequisites
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../getting_started/installing_docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../getting_started/building_adore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building ADORe
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Technical Reference Manual
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Technical Reference Manual
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../system_and_development/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submodules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../problems_and_solutions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../licensing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Licensing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../styleguide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Style Guide
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#panelapiusedatasourceinfo" class="md-nav__link">
    <span class="md-ellipsis">
      PanelAPI.useDataSourceInfo()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#panelapiusemessagesbytopic" class="md-nav__link">
    <span class="md-ellipsis">
      PanelAPI.useMessagesByTopic()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#panelapiusemessagereducer" class="md-nav__link">
    <span class="md-ellipsis">
      PanelAPI.useMessageReducer()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PanelAPI.useMessageReducer()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subscription-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Subscription parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reducer-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Reducer functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="panelapi">PanelAPI</h1>
<p>The <code>PanelAPI</code> namespace contains React <a href="https://reactjs.org/docs/hooks-intro.html">Hooks</a> and components which allow panel authors to access Lichtblick data and metadata inside their panels. Using these APIs across all panels helps ensure that data appears consistent among panels, and makes it easier for panels to support advanced features (such as multiple simultaneous data sources).</p>
<p>To use PanelAPI, it's recommended that you import the whole namespace, so that all usage sites look consistent, like <code>PanelAPI.useSomething()</code>.</p>
<pre><code class="language-js">import * as PanelAPI from &quot;@lichtblick/suite-base/PanelAPI&quot;;
</code></pre>
<h2 id="panelapiusedatasourceinfo"><a href="useDataSourceInfo.js"><code>PanelAPI.useDataSourceInfo()</code></a></h2>
<p>"Data source info" encapsulates <strong>rarely-changing</strong> metadata about the sources from which Lichtblick is loading data. (A data source might be a local <a href="http://wiki.ros.org/Bags/Format">bag file</a> dropped into the browser, or a bag stored on a remote server; see <a href="../players">players</a> and <a href="../dataSources">dataSources</a> for more details.)</p>
<p>Using this hook inside a panel will cause the panel to re-render automatically when the metadata changes, but this won't happen very often or during playback.</p>
<pre><code class="language-js"> PanelAPI.useDataSourceInfo(): {
  topics: Topic[],
  datatypes: RosDatatypes,
  capabilities: string[],
  startTime?: Time,
  playerId: string,
};
</code></pre>
<h2 id="panelapiusemessagesbytopic"><a href="useMessagesByTopic.js"><code>PanelAPI.useMessagesByTopic()</code></a></h2>
<p><code>useMessagesByTopic()</code> is a small wrapper around <code>PanelAPI.useMessageReducer</code> (see below). It makes it easy to just request some messages on some topics, without doing any transformations on the messages. This is convenient, but also means that the entire messages are kept in memory, so it's recommended to only use this for a small number of messages at a time (small <code>historySize</code>).</p>
<p>Using this hook will cause the panel to re-render when any new messages come in on the requested topics.</p>
<pre><code class="language-js">PanelAPI.useMessagesByTopic(props: {|
  topics: string[],
  historySize: number // Number of messages to keep per topic.
|}): { [topic: string]: Message[] };
</code></pre>
<h2 id="panelapiusemessagereducer"><a href="useMessageReducer.js"><code>PanelAPI.useMessageReducer()</code></a></h2>
<p><code>useMessageReducer()</code> provides panels a way to access <a href="http://wiki.ros.org/Messages">messages</a> from <a href="http://wiki.ros.org/Topics">topics</a>. <code>useMessageReducer</code> is a fairly <strong>low-level API</strong> that many panels will use via <code>PanelAPI.useMessagesByTopic</code> (see above). Users can define how to initialize a custom state, and how to update the state based on incoming messages.</p>
<p>Using this hook will cause the panel to re-render when any new messages come in on the requested topics.</p>
<pre><code class="language-js">PanelAPI.useMessageReducer&lt;T&gt;(props: {|
  topics: (string | { topic: string })[],
  restore: (prevState: ?T) =&gt; T,
  addMessage: (prevState: T, message: Message) =&gt; T,
|}): T;
</code></pre>
<h3 id="subscription-parameters">Subscription parameters</h3>
<ul>
<li><code>topics</code>: set of topics to subscribe to. Changing only the topics will not cause <code>restore</code> or <code>addMessage</code>/<code>addMessages</code> to be called.</li>
</ul>
<h3 id="reducer-functions">Reducer functions</h3>
<p>The <code>useMessageReducer</code> hook returns a user-defined "state" (<code>T</code>). The <code>restore</code> and <code>addMessage</code>/<code>addMessages</code> callbacks specify how to initialize and update the state.</p>
<p>These reducers should be wrapped in <a href="https://reactjs.org/docs/hooks-reference.html#usecallback"><code>useCallback()</code></a>, because the useMessageReducer hook will do extra work when they change, so they should change only when the interpretation of message data is actually changing.</p>
<ul>
<li>
<p><code>restore: (?T) =&gt; T</code>:</p>
</li>
<li>
<p>Called with <code>undefined</code> to initialize a new state when the panel first renders, and when the user seeks to a different playback time (at which point Lichtblick automatically clears out state across all panels).</p>
</li>
<li>
<p>Called with the previous state when the <code>restore</code> or <code>addMessage</code>/<code>addMessages</code> reducer functions change. This allows the panel an opportunity to reuse its previous state when a parameter changes, without totally discarding it (as in the case of a seek) and waiting for new messages to come in from the data source.</p>
<p>For example, a panel that filters some incoming messages can use <code>restore</code> to create a filtered value immediately when the filter changes. To implement this, the caller might switch from unfiltered reducers:</p>
<p><code>js
{
  restore: (x: ?string[]) =&gt; (x || []),
  addMessages: (x: string[], msgs: Message[]) =&gt; {
    msgs.forEach((m) =&gt; x.concat(m.data));
    return x;
  },
}</code></p>
<p>to reducers implementing a filter:</p>
<p><code>js
{
  restore: (x: ?string[]) =&gt; (x ? x.filter(predicate) : []),
  addMessages: (x: string[], msgs: Message[]) =&gt; {
    msgs.forEach((m) =&gt;  if (predicate(m.data)) x.concat(m.data));
    return x;
  },
}</code></p>
<p>As soon as the reducers are swapped, the <strong>new</strong> <code>restore()</code> will be called with the <strong>previous</strong> data. (If the filter is removed again, the old data that was filtered out can't be magically restored unless it was kept in the state, but hopefully future work to preload data faster than real-time will help us there.)</p>
</li>
<li>
<p><code>addMessages?: (T, Message[]) =&gt; T</code>: called when any new messages come in on one of the requested topics. Unlike <code>addMessage</code>, this callback is provided with every new message since the last call. Optional for back compat with older panels, this is the recommended approach moving forward.</p>
</li>
<li>
<p>(DEPRECATED) <code>addMessage?: (T, Message) =&gt; T</code>: called when any new message comes in on one of the requested topics. The return value from <code>addMessage</code> will be the new return value from <code>useMessageReducer()</code>. Will not be called if an addMessages callback was provided.</p>
</li>
<li>
<p>Note only one of the two optional parameters above must be provided, providng neither or providing both will result in an error.</p>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["content.code.copy"], "search": "../../../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>